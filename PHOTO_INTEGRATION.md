# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ñ–æ—Ç–æ –≤ Telegram –±–æ—Ç

## –û–±–∑–æ—Ä

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ Telegram –±–æ—Ç —Å —Ç—Ä–µ–º—è —Å–ø–æ—Å–æ–±–∞–º–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏:

1. **–ü–æ file_id** - –¥–ª—è —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –≤ Telegram –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
2. **–ò–∑ —Ñ–∞–π–ª–∞** - –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
3. **–ò–∑ io.Reader** - –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ –ø–∞–º—è—Ç–∏/–ø–æ—Ç–æ–∫–∞

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. Notifier –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (`internal/ports/notifier.go`)

```go
type Notifier interface {
    // –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã
    Send(ctx context.Context, chatID int64, text string, markup interface{}) error
    SendWithParseMode(ctx context.Context, chatID int64, text string, parseMode string, markup interface{}) error
    EditMessage(ctx context.Context, chatID int64, messageID int, text string, markup interface{}) error
    DeleteMessage(ctx context.Context, chatID int64, messageID int) error
    
    // –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ç–æ
    SendPhoto(ctx context.Context, chatID int64, photoFileID string, caption string, markup interface{}) error
    SendPhotoFromReader(ctx context.Context, chatID int64, photoReader io.Reader, caption string, markup interface{}) error
    SendPhotoFromFile(ctx context.Context, chatID int64, photoPath string, caption string, markup interface{}) error
    EditMessagePhoto(ctx context.Context, chatID int64, messageID int, photoFileID string, caption string, markup interface{}) error
}
```

### 2. Telegram Notifier (`internal/adapters/notify/tg_notifier.go`)

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ Notifier —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
- –û—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ –ø–æ file_id
- –û—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ –∏–∑ —Ñ–∞–π–ª–∞
- –û—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ –∏–∑ io.Reader
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∏ –∫ —Ñ–æ—Ç–æ
- –£–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

### 3. –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Ö–µ–Ω–¥–ª–µ—Ä–µ

```go
func (h *CallbackHandler) handleReferralRanking(ctx context.Context, chatID int64, messageID int) error {
    caption := ui.GetReferralRankingText()
    keyboard := ui.GetReferralRankingKeyboard()
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ –∏–∑ —Ñ–∞–π–ª–∞
    photoPath := "assets/images/referral_ranking.png"
    err := h.notifier.SendPhotoFromFile(ctx, chatID, photoPath, caption, keyboard)
    
    if err != nil {
        // Fallback –Ω–∞ –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        return h.editMessageWithID(chatID, messageID, caption, keyboard)
    }
    
    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    h.notifier.DeleteMessage(ctx, chatID, messageID)
    return nil
}
```

### 4. Use Case –º–µ—Ç–æ–¥—ã

–í `NotificationUseCase` –¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã:
- `SendNotificationWithPhoto()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å —Ñ–æ—Ç–æ
- `SendReferralRankingPhoto()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞

## –°–ø–æ—Å–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ file_id (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

```go
photoFileID := "AgACAgIAAxkBAAIBY2Y..." // file_id –∏–∑ Telegram
err := notifier.SendPhoto(ctx, chatID, photoFileID, caption, keyboard)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ë—ã—Å—Ç—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ (—Ñ–æ—Ç–æ —É–∂–µ –≤ Telegram)
- –ù–µ —Ä–∞—Å—Ö–æ–¥—É–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É
- –ù–∞–¥–µ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å file_id:**
1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–æ—Ç—É –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
2. –ü–æ–ª—É—á–∏—Ç—å file_id –∏–∑ webhook –∏–ª–∏ getUpdates
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑ —Ñ–∞–π–ª–∞ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```go
photoPath := "static/images/referral_ranking.png"
err := notifier.SendPhotoFromFile(ctx, chatID, photoPath, caption, keyboard)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Ñ–∞–π–ª–∞–º–∏

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ (–Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª)
- –†–∞—Å—Ö–æ–¥—É–µ—Ç —Ç—Ä–∞—Ñ–∏–∫

### 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑ io.Reader (–¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)

```go
photoReader := bytes.NewReader(imageBytes)
err := notifier.SendPhotoFromReader(ctx, chatID, photoReader, caption, keyboard)
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:**
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ –ª–µ—Ç—É
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ API
- –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤/–¥–∏–∞–≥—Ä–∞–º–º

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
static/
‚îú‚îÄ‚îÄ README.md              # –û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º —Ñ–∞–π–ª–∞–º
‚îî‚îÄ‚îÄ images/
    ‚îú‚îÄ‚îÄ README.md              # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    ‚îú‚îÄ‚îÄ referral_ranking.svg   # SVG —à–∞–±–ª–æ–Ω –¥–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞
    ‚îú‚îÄ‚îÄ referral_ranking.png   # PNG –≤–µ—Ä—Å–∏—è (—Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º)
    ‚îú‚îÄ‚îÄ create_simple_png.py   # –°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ PNG
    ‚îî‚îÄ‚îÄ convert.sh             # –°–∫—Ä–∏–ø—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ SVG –≤ PNG (–µ—Å–ª–∏ –µ—Å—Ç—å ImageMagick)
```

## –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 1. –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ —Å —Ñ–æ—Ç–æ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "üèÜ –†–µ–π—Ç–∏–Ω–≥" –≤ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–µ –º–µ–Ω—é, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### 2. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏

–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ NotificationUseCase.

### 3. Fallback –º–µ—Ö–∞–Ω–∏–∑–º

–ï—Å–ª–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ–±—ã—á–Ω–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ file_id - —ç—Ç–æ —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –∏ –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±
2. **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
3. **–í—Å–µ–≥–¥–∞ –ø—Ä–µ–¥—É—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ fallback** –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
4. **–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** - —Ä–∞–∑–º–µ—Ä –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–≤—ã—à–∞—Ç—å 10MB
5. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã** - JPG –¥–ª—è —Ñ–æ—Ç–æ, PNG –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –°–æ–∑–¥–∞–π—Ç–µ PNG —Ñ–∞–π–ª: `python3 static/images/create_simple_png.py`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `make run`
3. –ù–∞–∂–º–∏—Ç–µ "üèÜ –†–µ–π—Ç–∏–Ω–≥" –≤ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–º –º–µ–Ω—é
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ñ–æ—Ç–æ —Å –ø–æ–¥–ø–∏—Å—å—é –∏ –∫–Ω–æ–ø–∫–∞–º–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
3xui-bot/
‚îú‚îÄ‚îÄ static/                    # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îî‚îÄ‚îÄ images/
‚îÇ       ‚îú‚îÄ‚îÄ README.md
‚îÇ       ‚îú‚îÄ‚îÄ referral_ranking.png
‚îÇ       ‚îî‚îÄ‚îÄ create_simple_png.py
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ ports/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ notifier.go        # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ adapters/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notify/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tg_notifier.go # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Telegram notifier
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ bot/telegram/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ callback.go # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ —Ñ–æ—Ç–æ
‚îÇ   ‚îî‚îÄ‚îÄ usecase/
‚îÇ       ‚îî‚îÄ‚îÄ notification_usecase.go # Use case —Å –º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è —Ñ–æ—Ç–æ
‚îî‚îÄ‚îÄ PHOTO_INTEGRATION.md       # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```
